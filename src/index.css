@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --radius: 0.625rem;

    /* Base colors */
    --background: 0 0% 100%;
    /* hsl(0, 0%, 100%) */
    --foreground: 248 85% 7%;
    /* hsl(248, 85%, 7%) */
    --muted: 210 40% 96.1%;
    /* hsl(210, 40%, 96.1%) */
    --muted-foreground: 215.4 16.3% 46.9%;
    /* hsl(215.4, 16.3%, 46.9%) */
    --sidebar-accent: 214 32% 91%;
    /* hsl(214, 32%, 91%) */

    /* Primary (medio de --primary-gradient: mezcla de #6366f1 y #a78bfa => #8579f6) */
    --primary: 246 87% 72%;
    /* hsl(246, 87%, 72%) */

    /* Primary gradient used as a highlight */
    --primary-gradient: linear-gradient(90deg, #6366f1 0%, #a78bfa 100%);

    /* Gold */
    --gold: 45 74% 52%;
    /* hsl(45, 74%, 52%) */
    --gold-foreground: 0 0% 100%;
    /* white for legibility on gold */

    /* Destructive (red) */
    --destructive: 0 84.2% 60.2%;
    /* hsl(0, 84.2%, 60.2%) */

    /* Warning (orange) */
    --warning: 28 100% 50%;
    /* hsl(28, 100%, 50%) */
    --warning-foreground: 0 0% 0%;
    /* black for legibility on light backgrounds */

    /* Event colors */
    --class-color: 28, 100%, 50%;
    /* hsl(28, 100%, 50%) */
    --class-color-light: 28, 100%, 65%;
    /* hsl(28, 100%, 65%) - lighter for hover */
    --appointment-color: 155, 80%, 44%;
    /* hsl(155, 80%, 44%) */
    --calendar-today: 217, 90%, 92%;
    /* hsl(217, 90%, 92%) */

    /* Layout helpers */
    --section-search-width: 20rem;

    /* Aliases */
    --card: var(--background);
    --card-foreground: var(--foreground);
    --popover: var(--background);
    --popover-foreground: var(--foreground);
    --border: var(--muted);
    --input: var(--border);
    --accent: var(--muted);
    --accent-foreground: var(--foreground);
    --primary-foreground: var(--muted);
    --ring: var(--primary);
    --destructive-foreground: var(--primary-foreground);
    --vacation-color: var(--muted-foreground);
    --sidebar-background: var(--muted);
    --sidebar-foreground: var(--foreground);
    --sidebar-primary: var(--primary);
    --sidebar-primary-foreground: var(--muted);
    --sidebar-accent-foreground: var(--foreground);
    --sidebar-border: var(--border);
    --sidebar-ring: var(--primary);

    /* On colors */
    --on-primary: 0 0% 100%;
    /* white */
    --landing-navbar-height: 72px;
    /* Approximate height of Landing navbar for anchor offset */

    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(15, 23, 42, 0.04);
    --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    /* On-accent (text color for accent backgrounds) */
    --on-accent: 0 0% 0%;
    /* black */
  }

  * {
    border-color: hsl(var(--border));
  }

  body {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    font-family:
      Inter,
      ui-sans-serif,
      system-ui,
      -apple-system,
      'Segoe UI',
      Roboto,
      'Helvetica Neue',
      Arial,
      'Noto Sans',
      'Apple Color Emoji',
      'Segoe UI Emoji',
      'Segoe UI Symbol';
  }

  /* Reserve layout space for the vertical scrollbar to avoid jumps when it appears/disappears */
  html {
    scrollbar-gutter: stable;
    scroll-behavior: smooth;
  }

  /* Ensure headings are not hidden by the fixed navbar when linked */
  h2[id],
  h3[id] {
    scroll-margin-top: calc(var(--landing-navbar-height) + 8px);
  }

  /* Fallback for browsers that don't support scrollbar-gutter:
     force a persistent vertical scrollbar to prevent layout shift on dropdowns/overlays. */
  @supports not (scrollbar-gutter: stable) {

    /* Use overflow on html to ensure gutter space is reserved in more browsers */
    html {
      overflow-y: scroll;
    }
  }

  .ProseMirror {
    outline: none;
  }

  .ProseMirror p.is-editor-empty:first-child::before {
    color: hsl(var(--muted-foreground));
    content: attr(data-placeholder);
    float: left;
    height: 0;
    pointer-events: none;
  }

  .ProseMirror strong {
    font-weight: 600;
  }

  .ProseMirror em {
    font-style: italic;
  }

  .ProseMirror ul {
    list-style: disc;
    padding-left: 1.5rem;
  }

  .ProseMirror ol {
    list-style: decimal;
    padding-left: 1.5rem;
  }

  .ProseMirror li {
    margin: 0.25rem 0;
  }

  .ProseMirror p {
    margin: 0.5rem 0;
  }

  .ProseMirror p:first-child {
    margin-top: 0;
  }

  .ProseMirror p:last-child {
    margin-bottom: 0;
  }

  /* Layout helpers */
  .section-search {
    max-width: var(--section-search-width);
    width: 100%;
  }

  /* On small screens allow section controls to share a row without being constrained by max-width */
  @media (max-width: 640px) {
    .section-search {
      max-width: none;

      /* Default behavior for section search inputs on mobile: don't force ellipsis
         Allow wrapping/visible overflow so text is not truncated unnecessarily. */
      overflow: visible !important;
      white-space: normal !important;
      text-overflow: clip !important;
      min-width: 0;

      /* Also ensure placeholder doesn't get ellipsis applied by other rules */
      .section-search::placeholder {
        white-space: normal !important;
        text-overflow: clip !important;
        overflow: visible !important;
      }
    }

    /* Mobile-only: truncate placeholder/text in profesionales search to avoid overflow */
    .pro-section-search {
      /* allow shrinking inside flex containers */
      min-width: 0;

      /* Truncate visible text and placeholder via ellipsis only for profesionales */
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .pro-section-search::placeholder {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Clientes: fixed width based on placeholder, clear button as emoji overlay */
    .clientes-search-wrap {
      display: inline-flex;
      align-items: center;
      position: relative;
      height: 2.5rem;
      /* match input h-10 */
    }

    .clientes-section-search {
      display: inline-flex;
      align-items: center;
      padding-right: 1.75rem;
      /* reserve space for clear emoji */
      box-sizing: border-box;
      height: 2.5rem;
      /* enforce original input height */
      line-height: 1;
    }

    .clientes-clear-btn {
      position: absolute;
      right: 0.375rem;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      padding: 0;
      margin: 0;
      line-height: 1;
      font-size: 1rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .measure-span {
      position: absolute;
      visibility: hidden;
      white-space: pre;
      font: inherit;
      padding: 0 0.75rem;
      height: auto;
      display: inline-block;
    }
  }

  .popover-content-width {
    width: var(--section-search-width);
  }

  /* Utilities for event action buttons using theme variables */
  .btn-propagate {
    /* Use the page background as requested */
    background-color: hsl(var(--background));
    /* Ensure readable text on background */
    color: hsl(var(--foreground));
    border: 1px solid hsl(var(--border));
    transition:
      background-color 0.12s ease,
      border-color 0.12s ease,
      filter 0.08s ease;
  }

  /* Use a more specific selector and !important to override Tailwind utilities */
  .btn-propagate:hover,
  .btn-propagate:focus-visible,
  button.btn-propagate:hover,
  button.btn-propagate:focus-visible {
    background-color: hsl(var(--sidebar-accent)) !important;
    color: hsl(var(--on-accent)) !important;
  }

  /* Active / click state: slight darkening without movement */
  .btn-propagate:active {
    filter: brightness(0.92);
  }

  /* Action icon (reusable) */
  .action-icon {
    height: 1.75rem;
    /* h-7 */
    width: 1.75rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius);
    transition:
      background-color 0.12s ease,
      color 0.12s ease,
      transform 0.08s ease;
    outline: none;
    box-shadow: none;
    /* No background by default; hover will show accent */
    background-color: transparent;
    color: inherit;
  }

  /* Hover visuals only on devices that support hover (desktop) */
  @media (hover: hover) and (pointer: fine) {

    .action-icon:hover,
    .action-icon:focus-visible {
      background-color: hsl(var(--sidebar-accent));
      color: hsl(var(--on-accent));
      border: 1px solid hsl(var(--sidebar-border));
      box-shadow: var(--shadow-sm);
    }

    /* Allow opting out of hover color changes (useful when icon must keep a color like red) */
    @media (hover: hover) and (pointer: fine) {

      .no-hover-color.action-icon:hover,
      .no-hover-color.action-icon:focus-visible {
        color: #dc2626 !important;
        /* Tailwind red-600 */
      }
    }

    /* Landing navbar: use the purple from --primary-gradient for link hover/focus */
    @media (hover: hover) and (pointer: fine) {

      .landing-navbar .landing-nav-link:hover,
      .landing-navbar .landing-nav-link:focus-visible {
        color: #6366f1;
      }
    }
  }

  /* Disable hover visuals on touch devices (mobile) - apply broadly to buttons and interactive elements */
  @media (hover: none) and (pointer: coarse) {

    .action-icon:hover,
    .action-icon:focus-visible,
    button:hover,
    button:active,
    [role='button']:hover,
    [role='button']:active,
    a.button:hover,
    a[role='button']:hover {
      background-color: transparent !important;
      color: inherit !important;
      border: none !important;
      box-shadow: none !important;
      transform: none !important;
      filter: none !important;
    }
  }

  /* Typewriter caret and helper classes */
  .typewriter {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Reveal / fade-in utilities */
  .reveal {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 520ms cubic-bezier(.2, .9, .3, 1), transform 520ms cubic-bezier(.2, .9, .3, 1);
    will-change: opacity, transform;
  }

  .reveal-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Horizontal reveal variants (used for features previews)
     - .reveal-from-left: starts shifted left and animates to natural position
     - .reveal-from-right: starts shifted right and animates to natural position
  */
  .reveal-from-left {
    transform: translateX(-24px);
  }

  .reveal-from-right {
    transform: translateX(24px);
  }

  .reveal-visible.reveal-from-left,
  .reveal-visible.reveal-from-right {
    transform: translateX(0);
  }

  /* Reveal from bottom variant (titles) */
  .reveal-from-bottom {
    transform: translateY(28px);
  }

  .reveal-visible.reveal-from-bottom {
    transform: translateY(0);
  }

  .typewriter-text {
    white-space: nowrap;
    overflow: hidden;
    display: inline-block;
  }

  .typewriter-caret {
    display: inline-block;
    width: 2px;
    height: 1em;
    background-color: currentColor;
    animation: typewriter-blink 1s step-end infinite;
    margin-left: 0.15rem;
  }

  @keyframes typewriter-blink {
    50% {
      opacity: 0;
    }

    100% {
      opacity: 1;
    }
  }

  /* Reduce action icon size on small screens to avoid overflow */
  @media (max-width: 640px) {
    .action-icon {
      height: 1.5rem;
      width: 1.5rem;
    }

    /* Client cita cards: specify mobile grid columns so middle column takes remaining space */
    .cliente-citas-grid {
      /* Allow the date column to size to its content on small screens so the avatar sits closer
         Use auto for the cost and status columns so they shrink to their content on mobile */
      grid-template-columns: auto 1fr auto auto;
    }
  }

  /* Also remove hover-based focus outlines for touch */
  :focus:not(:focus-visible) {
    outline: none !important;
  }

  /* Hide scrollbars utility (webkit + firefox + IE) */
  .hide-scrollbar {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
  }

  .hide-scrollbar::-webkit-scrollbar {
    display: none;
    /* Chrome, Safari, Opera */
  }

  /* Drag and drop styling */
  [data-slot-id] {
    cursor: grab;
  }

  /* Ensure media elements can shrink inside flex/grid items (fixes videos not scaling on zoom) */
  .shrink-media {
    /* Allow the container to shrink inside flex/grid layouts */
    min-width: 0;
    min-height: 0;
  }

  .shrink-media img,
  .shrink-media video {
    /* Prevent the media from imposing intrinsic min sizes */
    min-width: 0;
    min-height: 0;
    max-width: 100%;
    max-height: 100%;
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
  }

  /* Ensure the active tab on the Cliente view is visible on small screens */
  @media (max-width: 640px) {
    .cliente-tabs {
      background-color: hsl(var(--muted));
      border-radius: 0.5rem;
      padding: 0.125rem;
    }

    .cliente-tabs [data-state="active"] {
      background-color: hsl(var(--background)) !important;
      color: hsl(var(--foreground)) !important;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
    }

    /* Make sure triggers don't lose contrast when active */
    .cliente-tabs [data-state="active"] svg {
      color: inherit;
    }
  }
}